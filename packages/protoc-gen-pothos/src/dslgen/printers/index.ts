import type { createRegistry } from "@bufbuild/protobuf";
import {
  EnumType,
  InputObjectType,
  ObjectType,
  OneofUnionType,
  SquashedOneofUnionType,
} from "@proto-graphql/codegen-core";

import type { GeneratedFile } from "@bufbuild/protoplugin";
import { printEnumType } from "./enumType.js";
import { printInputObjectType } from "./inputObjectType.js";
import { printObjectType } from "./objectType.js";
import { printOneofUnionType } from "./oneofUnionType.js";
import type { PothosPrinterOptions } from "./util.js";

export function printTypeDsl(
  f: GeneratedFile,
  types: (
    | ObjectType
    | InputObjectType
    | EnumType
    | OneofUnionType
    | SquashedOneofUnionType
  )[],
  registry: ReturnType<typeof createRegistry>,
  opts: PothosPrinterOptions,
): void {
  // Generate header comment
  f.print("// Code generated by protoc-gen-pothos. DO NOT EDIT.");
  f.print("");
  f.print("/* eslint-disable */");
  f.print("");

  // Print each type
  let index = 0;
  for (const type of types) {
    if (index > 0) {
      f.print("");
    }

    if (type instanceof ObjectType) {
      printObjectType(f, type, registry, opts);
    } else if (type instanceof InputObjectType) {
      printInputObjectType(f, type, registry, opts);
    } else if (type instanceof EnumType) {
      printEnumType(f, type, registry, opts);
    } else if (
      type instanceof OneofUnionType ||
      type instanceof SquashedOneofUnionType
    ) {
      printOneofUnionType(f, type, registry, opts);
    } else {
      const _exhaustiveCheck: never = type;
      throw "unreachable";
    }

    index++;
  }
}
